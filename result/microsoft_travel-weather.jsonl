{"repo_info": {"repo_name": "travel-weather", "repo_owner": "microsoft", "repo_url": "https://github.com/microsoft/travel-weather"}}
{"type": "test_file", "path": "webapp/test_main.py", "content": "from main import app\nfrom fastapi.testclient import TestClient\n\nclient = TestClient(app)\n\n\ndef test_root():\n    response = client.get(\"/\")\n    assert response.status_code == 200\n\n\ndef test_countries():\n    response = client.get(\"/countries\")\n    assert response.status_code == 200\n    assert sorted(response.json()) == [\"England\", \"France\", \"Germany\", \"Italy\", \"Peru\", \"Portugal\", \"Spain\"]"}
{"type": "source_file", "path": "webapp/main.py", "content": "import json\nfrom os.path import dirname, abspath, join\nfrom fastapi import FastAPI\nfrom fastapi.responses import RedirectResponse\nfrom fastapi.staticfiles import StaticFiles\n\n\ncurrent_dir = dirname(abspath(__file__))\nwellknown_path = join(current_dir, \".well-known\")\nhistorical_data = join(current_dir, \"weather.json\")\n\napp = FastAPI()\napp.mount(\"/.well-known\", StaticFiles(directory=wellknown_path), name=\"static\")\n\n\n# load historical json data and serialize it:\nwith open(historical_data, \"r\") as f:\n    data = json.load(f)\n\n@app.get('/')\ndef root():\n    \"\"\"\n    Allows to open the API documentation in the browser directly instead of\n    requiring to open the /docs path.\n    \"\"\"\n    return RedirectResponse(url='/docs', status_code=301)\n\n\n@app.get('/countries')\ndef countries():\n    return list(data.keys())\n\n\n@app.get('/countries/{country}/{city}/{month}')\ndef monthly_average(country: str, city: str, month: str):\n    return data[country][city][month]\n\n# Generate the OpenAPI schema:\nopenapi_schema = app.openapi()\nwith open(join(wellknown_path, \"openapi.json\"), \"w\") as f:\n    json.dump(openapi_schema, f)"}
