{"repo_info": {"repo_name": "DevOn", "repo_owner": "lordspline", "repo_url": "https://github.com/lordspline/DevOn"}}
{"type": "source_file", "path": "agent.py", "content": "from openai import OpenAI\nfrom prompts.orchestrator import orchestrator_prompt\nfrom prompts.programmer import programmer_notes\nfrom prompts.notetaker import notetaker_notes\nfrom dotenv import load_dotenv\nimport time\nimport multion\nfrom multion.client import MultiOn\nimport os\n\nload_dotenv(\".env.local\")\n\n# replit_email = os.getenv(\"REPLIT_EMAIL\")\n# replit_password = os.getenv(\"REPLIT_PASSWORD\")\n\n# multion_api_key = os.getenv(\"MULTION_API_KEY\")\n# multion.login(use_api=True, multion_api_key=multion_api_key)\n\n# runpod_url = os.getenv(\"RUNPOD_URL\")\n\nimage_temp = \"https://miro.medium.com/v2/resize:fit:1200/0*n-2bW82Z6m6U2bij.jpeg\"\n\n\nclass DevOn:\n    def __init__(\n        self,\n        editor_image,\n        browser_image,\n        scratchpad_image,\n        multion_api_key,\n        openai_api_key,\n        replit_email,\n        replit_password,\n        local,\n    ):\n        print(multion_api_key, openai_api_key)\n        self.editor_image = editor_image\n        self.browser_image = browser_image\n        self.scratchpad_image = scratchpad_image\n        self.local = local\n        # if os.getenv(\"WHERE_EXECUTE\"):\n        #     self.local = local\n        # else:\n        #     self.local = False\n\n        self.multion = MultiOn(api_key=multion_api_key)\n\n        self.replit_email = replit_email\n        self.replit_password = replit_password\n\n        self.programmer = self.multion.sessions.create(\n            url=\"https://replit.com/login\", local=self.local, include_screenshot=True\n        )\n        self.programmer_logged_in = False\n        # self.editor_image = self.programmer.screenshot\n        self.editor_image = self.multion.sessions.screenshot(\n            session_id=self.programmer.session_id\n        ).screenshot\n        print(self.editor_image)\n        time.sleep(1)\n        # print(self.programmer)\n\n        self.researcher = self.multion.sessions.create(\n            url=\"https://www.google.com\", local=self.local, include_screenshot=True\n        )\n        # self.browser_image = self.researcher.screenshot\n        self.browser_image = self.multion.sessions.screenshot(\n            session_id=self.researcher.session_id\n        ).screenshot\n        time.sleep(1)\n\n        self.notetaker = self.multion.sessions.create(\n            url=\"https://anotepad.com/\", local=self.local, include_screenshot=True\n        )\n        # self.scratchpad_image = self.notetaker.screenshot\n        self.scratchpad_image = self.multion.sessions.screenshot(\n            session_id=self.notetaker.session_id\n        ).screenshot\n        time.sleep(1)\n\n        self.done = True\n        self.task = \"\"\n        self.plan = \"\"\n        self.messages = []\n        self.client = OpenAI(api_key=openai_api_key)\n\n    def programmer_login(self):\n        if self.local:\n            cmd = \"Create a new Python REPL.\"\n        else:\n            cmd = \"Log in with the email {email} and the password {password}. Then create a new Python REPL.\".format(\n                email=self.replit_email, password=self.replit_password\n            )\n        while True:\n            self.programmer = self.multion.sessions.step(\n                self.programmer.session_id,\n                cmd=cmd + \"\\n\\n\" + programmer_notes,\n                url=\"https://replit.com/login\",\n                include_screenshot=True,\n            )\n            print(self.programmer)\n            print(\n                self.multion.sessions.screenshot(\n                    session_id=self.programmer.session_id\n                ).screenshot\n            )\n            # time.sleep(1)\n            # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n            # self.editor_image = self.programmer[\"screenshot\"]\n            if self.programmer.status in [\"DONE\", \"NOT SURE\"]:\n                break\n\n        self.editor_image = self.multion.sessions.screenshot(\n            session_id=self.programmer.session_id\n        ).screenshot\n        time.sleep(1)\n\n    def prepare_messages(self):\n        messages = [\n            {\"role\": \"user\", \"content\": orchestrator_prompt},\n            {\n                \"role\": \"user\",\n                \"content\": \"The Task given to you is: {task}\".format(task=self.task),\n            },\n            {\n                \"role\": \"user\",\n                \"content\": \"The current Plan state is: {plan}\".format(plan=\"\"),\n            },\n        ]\n        for message in self.messages:\n            messages.append(message)\n\n        messages.append(\n            {\n                \"role\": \"user\",\n                \"content\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"This is the current state of the Programmer Intern.\",\n                    },\n                    {\"type\": \"image_url\", \"image_url\": {\"url\": self.editor_image}},\n                ],\n            }\n        )\n        messages.append(\n            {\n                \"role\": \"user\",\n                \"content\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"This is the current state of the Researcher Intern.\",\n                    },\n                    {\"type\": \"image_url\", \"image_url\": {\"url\": self.browser_image}},\n                ],\n            }\n        )\n        messages.append(\n            {\n                \"role\": \"user\",\n                \"content\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"This is the current state of the Notetaker Intern.\",\n                    },\n                    {\"type\": \"image_url\", \"image_url\": {\"url\": self.scratchpad_image}},\n                ],\n            }\n        )\n        return messages\n\n    def execute_action(self, action):\n\n        action_func = action.split(\" \", 1)[0]\n\n        if action_func == \"submit\":\n            self.done = True\n            return\n        elif action_func == \"update_plan\":\n            action_arg = action.split(\" \", 1)[1]\n            self.plan = action_arg\n            return\n        elif action_func == \"programmer\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.programmer = self.multion.sessions.step(\n                    self.programmer.session_id,\n                    cmd=action_arg + \"\\n\\n\" + programmer_notes,\n                    url=\"https://replit.com/login\",\n                    include_screenshot=True,\n                )\n                print(self.programmer)\n                # if self.programmer.status == \"NOT SURE\":\n                #     self.messages.append(\n                #         {\n                #             \"role\": \"user\",\n                #             \"content\": \"The Programmer says: {message}\\n\\nYour next reply will go to the programmer.\".format(\n                #                 message=self.programmer.message\n                #             ),\n                #         }\n                #     )\n                #     chat_completion = self.client.chat.completions.create(\n                #         messages=self.prepare_messages(),\n                #         model=\"gpt-4-vision-preview\",\n                #         # max_tokens=200,\n                #     )\n                #     action_arg = chat_completion.choices[0].message.content\n                #     self.messages.append({\"role\": \"assistant\", \"content\": action_arg})\n                # else:\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Programmer says: {message}\".format(\n                            message=self.programmer.message\n                        ),\n                    }\n                )\n                # time.sleep(1)\n                # self.editor_image = self.programmer[\"screenshot\"]\n                # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                if self.programmer.status in [\"DONE\", \"NOT SURE\"]:\n                    break\n            self.editor_image = self.multion.sessions.screenshot(\n                session_id=self.programmer.session_id\n            ).screenshot\n            print(self.editor_image)\n            time.sleep(1)\n            return\n        elif action_func == \"researcher\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.researcher = self.multion.sessions.step(\n                    self.researcher.session_id,\n                    cmd=action_arg,\n                    url=\"https://www.google.com\",\n                    include_screenshot=True,\n                )\n                print(self.researcher)\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Researcher says: {message}\".format(\n                            message=self.researcher.message\n                        ),\n                    }\n                )\n                # time.sleep(1)\n                # self.browser_image = self.researcher[\"screenshot\"]\n                # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                if self.researcher.status == \"DONE\":\n                    break\n            self.browser_image = self.multion.sessions.screenshot(\n                session_id=self.researcher.session_id\n            ).screenshot\n            print(self.browser_image)\n            time.sleep(1)\n            return\n        elif action_func == \"notetaker\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.notetaker = self.multion.sessions.step(\n                    self.notetaker.session_id,\n                    cmd=action_arg + \"\\n\\n\" + notetaker_notes,\n                    url=\"https://anotepad.com/\",\n                    include_screenshot=True,\n                )\n                print(self.notetaker)\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Notetaker says: {message}\".format(\n                            message=self.notetaker.message\n                        ),\n                    }\n                )\n                # time.sleep(1)\n                # self.scratchpad_image = self.notetaker[\"screenshot\"]\n                # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                if self.notetaker.status == \"DONE\":\n                    break\n            self.scratchpad_image = self.multion.sessions.screenshot(\n                session_id=self.notetaker.session_id\n            ).screenshot\n            print(self.scratchpad_image)\n            time.sleep(1)\n            return\n        elif action_func == \"clarify\":\n            action_arg = action.split(\" \", 1)[1]\n            return\n\n    def orchestrator(self):\n        if not self.programmer_logged_in:\n            self.programmer_login()\n            self.programmer_logged_in = True\n        messages = self.prepare_messages()\n        chat_completion = self.client.chat.completions.create(\n            messages=messages,\n            model=\"gpt-4-vision-preview\",\n            # max_tokens=200,\n        )\n        response = chat_completion.choices[0].message.content\n        action, explanation = response.split(\"Explanation: \", 1)\n        action = action.split(\"Action: \", 1)[1]\n\n        self.messages.append({\"role\": \"assistant\", \"content\": response})\n        self.messages.append(\n            {\n                \"role\": \"user\",\n                \"content\": \"The current Plan state is: {plan}\".format(plan=self.plan),\n            }\n        )\n        print(self.messages)\n\n        # self.execute_action(action)\n\n        action_func = action.split(\" \", 1)[0]\n\n        if action_func == \"submit\":\n            self.done = True\n        elif action_func == \"update_plan\":\n            action_arg = action.split(\" \", 1)[1]\n            self.plan = action_arg\n        elif action_func == \"programmer\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.programmer = self.multion.sessions.step(\n                    self.programmer.session_id,\n                    cmd=action_arg + \"\\n\\n\" + programmer_notes,\n                    url=\"https://replit.com/login\",\n                    include_screenshot=True,\n                )\n                print(self.programmer)\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Programmer says: {message}\".format(\n                            message=self.programmer.message\n                        ),\n                    }\n                )\n                if self.programmer.status in [\"DONE\", \"NOT SURE\"]:\n                    break\n            self.editor_image = self.multion.sessions.screenshot(\n                session_id=self.programmer.session_id\n            ).screenshot\n            print(self.editor_image)\n            time.sleep(1)\n        elif action_func == \"researcher\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.researcher = self.multion.sessions.step(\n                    self.researcher.session_id,\n                    cmd=action_arg,\n                    url=\"https://www.google.com\",\n                    include_screenshot=True,\n                )\n                print(self.researcher)\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Researcher says: {message}\".format(\n                            message=self.researcher.message\n                        ),\n                    }\n                )\n                # time.sleep(1)\n                # self.browser_image = self.researcher[\"screenshot\"]\n                # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                if self.researcher.status == \"DONE\":\n                    break\n            self.browser_image = self.multion.sessions.screenshot(\n                session_id=self.researcher.session_id\n            ).screenshot\n            print(self.browser_image)\n            time.sleep(1)\n        elif action_func == \"notetaker\":\n            action_arg = action.split(\" \", 1)[1]\n            while True:\n                self.notetaker = self.multion.sessions.step(\n                    self.notetaker.session_id,\n                    cmd=action_arg + \"\\n\\n\" + notetaker_notes,\n                    url=\"https://anotepad.com/\",\n                    include_screenshot=True,\n                )\n                print(self.notetaker)\n                self.messages.append(\n                    {\n                        \"role\": \"user\",\n                        \"content\": \"The Notetaker says: {message}\".format(\n                            message=self.notetaker.message\n                        ),\n                    }\n                )\n                # time.sleep(1)\n                # self.scratchpad_image = self.notetaker[\"screenshot\"]\n                # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                if self.notetaker.status == \"DONE\":\n                    break\n            self.scratchpad_image = self.multion.sessions.screenshot(\n                session_id=self.notetaker.session_id\n            ).screenshot\n            print(self.scratchpad_image)\n            time.sleep(1)\n        elif action_func == \"clarify\":\n            action_arg = action.split(\" \", 1)[1]\n\n        return explanation\n\n    def run(self, prompt):\n        self.done = False\n        self.task = prompt\n        while not self.done:\n            # curr_response = self.orchestrator()\n\n            if not self.programmer_logged_in:\n                # self.programmer_login()\n                if self.local:\n                    cmd = \"Create a new Python REPL.\"\n                else:\n                    cmd = \"Log in with the email {email} and the password {password}. Then create a new Python REPL.\".format(\n                        email=self.replit_email, password=self.replit_password\n                    )\n                while True:\n                    self.programmer = self.multion.sessions.step(\n                        self.programmer.session_id,\n                        cmd=cmd + \"\\n\\n\" + programmer_notes,\n                        url=\"https://replit.com/login\",\n                        include_screenshot=True,\n                    )\n                    print(self.programmer)\n                    print(\n                        self.multion.sessions.screenshot(\n                            session_id=self.programmer.session_id\n                        ).screenshot\n                    )\n                    # time.sleep(1)\n                    # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                    # self.editor_image = self.programmer[\"screenshot\"]\n                    if self.programmer.status in [\"DONE\", \"NOT SURE\"]:\n                        break\n                    self.editor_image = self.multion.sessions.screenshot(\n                        session_id=self.programmer.session_id\n                    ).screenshot\n                    time.sleep(1)\n                    yield (\n                        \"I am setting up the programming environment\",\n                        self.editor_image,\n                        self.browser_image,\n                        self.scratchpad_image,\n                    )\n\n                self.editor_image = self.multion.sessions.screenshot(\n                    session_id=self.programmer.session_id\n                ).screenshot\n                time.sleep(1)\n                self.programmer_logged_in = True\n            messages = self.prepare_messages()\n            chat_completion = self.client.chat.completions.create(\n                messages=messages,\n                model=\"gpt-4-vision-preview\",\n                # max_tokens=200,\n            )\n            response = chat_completion.choices[0].message.content\n            action, explanation = response.split(\"Explanation: \", 1)\n            action = action.split(\"Action: \", 1)[1]\n\n            self.messages.append({\"role\": \"assistant\", \"content\": response})\n            self.messages.append(\n                {\n                    \"role\": \"user\",\n                    \"content\": \"The current Plan state is: {plan}\".format(\n                        plan=self.plan\n                    ),\n                }\n            )\n            print(self.messages)\n\n            # self.execute_action(action)\n\n            action_func = action.split(\" \", 1)[0]\n\n            if action_func == \"submit\":\n                self.done = True\n                yield (\n                    explanation,\n                    self.editor_image,\n                    self.browser_image,\n                    self.scratchpad_image,\n                )\n            elif action_func == \"update_plan\":\n                action_arg = action.split(\" \", 1)[1]\n                self.plan = action_arg\n                yield (\n                    explanation,\n                    self.editor_image,\n                    self.browser_image,\n                    self.scratchpad_image,\n                )\n            elif action_func == \"programmer\":\n                action_arg = action.split(\" \", 1)[1]\n                while True:\n                    self.programmer = self.multion.sessions.step(\n                        self.programmer.session_id,\n                        cmd=action_arg + \"\\n\\n\" + programmer_notes,\n                        url=\"https://replit.com/login\",\n                        include_screenshot=True,\n                    )\n                    print(self.programmer)\n                    self.messages.append(\n                        {\n                            \"role\": \"user\",\n                            \"content\": \"The Programmer says: {message}\".format(\n                                message=self.programmer.message\n                            ),\n                        }\n                    )\n                    if self.programmer.status in [\"DONE\", \"NOT SURE\"]:\n                        break\n                    self.editor_image = self.multion.sessions.screenshot(\n                        session_id=self.programmer.session_id\n                    ).screenshot\n                    print(self.editor_image)\n                    time.sleep(1)\n                    yield (\n                        explanation,\n                        self.editor_image,\n                        self.browser_image,\n                        self.scratchpad_image,\n                    )\n                self.editor_image = self.multion.sessions.screenshot(\n                    session_id=self.programmer.session_id\n                ).screenshot\n                print(self.editor_image)\n                time.sleep(1)\n            elif action_func == \"researcher\":\n                action_arg = action.split(\" \", 1)[1]\n                while True:\n                    self.researcher = self.multion.sessions.step(\n                        self.researcher.session_id,\n                        cmd=action_arg,\n                        url=\"https://www.google.com\",\n                        include_screenshot=True,\n                    )\n                    print(self.researcher)\n                    self.messages.append(\n                        {\n                            \"role\": \"user\",\n                            \"content\": \"The Researcher says: {message}\".format(\n                                message=self.researcher.message\n                            ),\n                        }\n                    )\n                    # time.sleep(1)\n                    # self.browser_image = self.researcher[\"screenshot\"]\n                    # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                    if self.researcher.status == \"DONE\":\n                        break\n                    self.browser_image = self.multion.sessions.screenshot(\n                        session_id=self.researcher.session_id\n                    ).screenshot\n                    print(self.browser_image)\n                    time.sleep(1)\n                    yield (\n                        explanation,\n                        self.editor_image,\n                        self.browser_image,\n                        self.scratchpad_image,\n                    )\n                self.browser_image = self.multion.sessions.screenshot(\n                    session_id=self.researcher.session_id\n                ).screenshot\n                print(self.browser_image)\n                time.sleep(1)\n            elif action_func == \"notetaker\":\n                action_arg = action.split(\" \", 1)[1]\n                while True:\n                    self.notetaker = self.multion.sessions.step(\n                        self.notetaker.session_id,\n                        cmd=action_arg + \"\\n\\n\" + notetaker_notes,\n                        url=\"https://anotepad.com/\",\n                        include_screenshot=True,\n                    )\n                    print(self.notetaker)\n                    self.messages.append(\n                        {\n                            \"role\": \"user\",\n                            \"content\": \"The Notetaker says: {message}\".format(\n                                message=self.notetaker.message\n                            ),\n                        }\n                    )\n                    # time.sleep(1)\n                    # self.scratchpad_image = self.notetaker[\"screenshot\"]\n                    # yield (\"\", self.editor_image, self.browser_image, self.scratchpad_image)\n                    if self.notetaker.status == \"DONE\":\n                        break\n                    self.scratchpad_image = self.multion.sessions.screenshot(\n                        session_id=self.notetaker.session_id\n                    ).screenshot\n                    print(self.scratchpad_image)\n                    time.sleep(1)\n                    yield (\n                        explanation,\n                        self.editor_image,\n                        self.browser_image,\n                        self.scratchpad_image,\n                    )\n                self.scratchpad_image = self.multion.sessions.screenshot(\n                    session_id=self.notetaker.session_id\n                ).screenshot\n                print(self.scratchpad_image)\n                time.sleep(1)\n            elif action_func == \"clarify\":\n                action_arg = action.split(\" \", 1)[1]\n                yield (\n                    explanation,\n                    self.editor_image,\n                    self.browser_image,\n                    self.scratchpad_image,\n                )\n\n            # return explanation\n\n            # yield (\n            #     curr_response,\n            #     self.editor_image,\n            #     self.browser_image,\n            #     self.scratchpad_image,\n            # )\n"}
{"type": "source_file", "path": "editor.py", "content": "import gradio as gr\nimport os\nimport time\nimport ngrok\nfrom dotenv import load_dotenv\n\nload_dotenv(\".env.local\")\n\n\ndef new_file(file_name):\n    # print(file_explorer)\n    new_file_path = os.path.join(os.getcwd(), \"dev\", file_name)\n    open(new_file_path, \"w\")\n\n\ndef set_current_file(file):\n    if file is None:\n        return \"\"\n    file_content = \"\"\n    with open(file) as f:\n        file_content = f.read()\n    return file_content\n\n\ndef update_file(current_file, editor_content):\n    with open(current_file, \"w\") as f:\n        f.write(editor_content)\n    return current_file, editor_content, \"\"\n\n\nwith gr.Blocks(css=\"footer {visibility: hidden}\") as demo:\n    with gr.Row():\n        with gr.Column() as c:\n            file_explorer = gr.FileExplorer(file_count=\"single\", root_dir=\"dev\")\n            new_file_name = gr.Textbox(label=\"New File Name\")\n            new_file_button = gr.Button(\n                \"Create New File (After creating a new file, you must refresh the page to see the changes.)\"\n            )\n\n        with gr.Column():\n            code_display = gr.Code(\n                \"Select a file to start\",\n                language=\"python\",\n                label=\"Code Display (Displays file's current state, cannot edit this.)\",\n            )\n            code_editor = gr.Code(\n                \"\",\n                language=\"python\",\n                label=\"Code Editor (Enter the updated code to put in the file here.)\",\n            )\n            update_button = gr.Button(\"Update File\")\n\n    file_explorer.change(set_current_file, file_explorer, code_display)\n    update_button.click(\n        update_file,\n        [file_explorer, code_editor],\n        [file_explorer, code_display, code_editor],\n    )\n    new_file_button.click(new_file, new_file_name)\n    # with gr.Row():\n    #     save_button = gr.Button(\"Save Current File\")\n\nif __name__ == \"__main__\":\n    demo.queue()\n    listener = ngrok.forward(9000, authtoken_from_env=True)\n    print(f\"Ingress established at {listener.url()}\")\n    demo.launch(server_port=9000)\n"}
{"type": "source_file", "path": "prompts/notetaker.py", "content": "notetaker_notes = \"\"\"Important Notes:\nDon't write anything in the Note Title field.\nWhatever notes you are told to make, write them in one go, don't press enter or type multiple times, because everytime you write, it will replace the prevoius content.\nYou do not need to Save the note. When asked to note something down, just write it on the notepad. That is enough.\"\"\"\n"}
{"type": "source_file", "path": "prompts/orchestrator.py", "content": "orchestrator_prompt = \"\"\"**General**\n\n- You are DevOn, an expert Software Developer.\n- You will be asked to develop a new software project from scratch. You will primarily work in Python. You will deal with large software projects spanning multiple files and user requirements.\n- Your lifecycle will essentially circle around the Task, the State, your Plan, your Actions, and your Interns. Each of these are described in detail below.\n- To start with, your Plan will be empty. You will receive a State (in the form of 3 images, one from each of your Interns) and a Task. You will construct a Plan outlining the steps you will need to take to complete the Task, then ask your Interns to do things in order to incrementally fulfil the steps and complete the Task.\n- With each step, you will also provide an Explanation, explaining to the user what you are currently doing, so they may be able to keep track and monitor your progress. For example:\n    - Explanation: I am currently updating the plan based on the current state and the Task.\n    - Explanation: I am currently creating a file called utils.py which will contain utility functions.\n\n**State**\n\n**Interns**\n\n- You have 3 interns who will help you with different tasks - a Programmer, a Researcher, and a Planner. Here’s some info about them:\n    - Programmer: the Programmer is great at writing code given very specific instructions but isn’t a good long term planner. The Programmer works on Replit. You can ask the Programmer to write some code in certain files, make new files, etc. You can even give loose instructions like “Make a new file and write basic skeleton for an Agent class in it.” Keep in mind that the Programmer works exclusively in an online Replit IDE environment. Make sure your Plan and your Actions take this into consideration.\n    - Researcher: the Researcher is very handy with a browser and great at finding out technical details, documentation, examples, miscellaneous information, etc. You can ask it to do things like “Find out how to make an LLM call using the Perplexity API”.\n    - Notetaker: the Notetaker has a notepad and can note down anything you want. You will be able to see the notepad at all times. Anytime you want anything written down just to keep track of it, ask the Planner to do so.\n\n**Plan**\n\n- You have a persistent object to keep track of things: a Plan.\n- If the plan is empty, you will create a plan using the current state of things and the given task. You will do so using the update_plan action described below.\n\n**Actions**\n\n- There are 6 actions that you can take at the current time step. You must always take a valid action. You will complete the task by taking actions. You are free to take as many actions as needed (even hundreds), don’t try to rush by compressing multiple actions into one. These are the available actions:\n    - update_plan <plan>: Update Plan’s value to <plan>. This will replace the old value, not append to it. If there’s something from the old plan you wish to include in the updated one, make sure to include it in the <plan> you provide as an argument. Some examples how you can use this:\n        - update_plan In order to carry out the task of creating a Flask web server, I will need to take the following steps:\n        1) …\n        2) …\n        3) …\n    - programmer <task>: Ask the Programmer to carry out a <task>. Some examples of how you can use this:\n        - programmer Create a new Python file for utils called utils.py and write a generate_random_number() function in it that takes no parameters and returns a random number.\n        - programmer Go to the model.py file and import generate_random_number() from utils.\n    - researcher <task>: Ask the Researcher to carry out a <task>. The Researcher will reply to you with the information you asked for. Some examples of how you can use this:\n        - researcher Find out how the OpenAI API is used.\n        - researcher What is a SERP API I could use?\n    - notetaker <note>: Ask the Notetaker to carry out a <task>. Some examples of how you can use this:\n        - notetaker Note down the following information: MULTION_API_KEY=…\n        - notetaker Note down the following information: An example Chat Completions API call looks like the following:\n        from openai import OpenAI\n        client = OpenAI()\n        \n        response = client.chat.completions.create(\n          model=\"gpt-3.5-turbo\",\n          messages=[\n            {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n            {\"role\": \"user\", \"content\": \"Who won the world series in 2020?\"},\n            {\"role\": \"assistant\", \"content\": \"The Los Angeles Dodgers won the World Series in 2020.\"},\n            {\"role\": \"user\", \"content\": \"Where was it played?\"}\n          ]\n        )\n    - clarify <question>: Clarify something about the Task. Sometimes, there may be missing information, such as logins, api keys, or some requirements of the Task may be unclear. Use this Action to clarify things from the user by asking <question>. Use this sparingly. Try and make decisions yourself. Some examples of how you can use this:\n        - clarify The Task mentions that I need to benchmark the Perplexity API. Could you provide your API Key?\n    - submit: The Task is completed and you are ready to submit the output (whatever the programmer has so far). This is end the execution. Only do this when you are completely sure.\n\n**Important Notes**\n\n- Respond only by taking an Action (and providing the accompanying Explanation). Any response from you must be one of the above Actions. No other text in the response, just the Action and the Explanation. You will structure your output as such:\n”Action: <action>\\nExplanation: <explanation>”\n- You do not need to ask the Programmer to log in.\n- You can see all the Interns screens. If it seems like an Intern has made a mistake or encountered an error, you can tell them about it using the relevant action and ask them to correct it. This is especially important with the Programmer.\n- When you ask the programmer to write some code, ask it like this: \"programmer memorize the following code and write it in the editor: <code>\"\n- When you ask the programmer to write some code, make sure the code does not include any double quotation marks, only single quotation marks. E.g. \"hello world\" should instead be 'hello world'.\n- Do not ask the programmer to create new files.\n- When writing code, it is preferable to keep it small and simple. Don't write too much fluff.\n- Remember to only use single quotation marks.\n\"\"\"\n"}
{"type": "source_file", "path": "app.py", "content": "import gradio as gr\nimport os\nimport time\nfrom agent import DevOn\n\nimage_temp = \"https://miro.medium.com/v2/resize:fit:1200/0*n-2bW82Z6m6U2bij.jpeg\"\n# devon = DevOn(\n#     editor_image=image_temp, browser_image=image_temp, scratchpad_image=image_temp\n# )\ndevon = None\n# multion_api_key = \"\"\n# openai_api_key = \"\"\n# replit_email = \"\"\n# replit_password = \"\"\n\n\ndef add_message(history, message):\n    # for x in message[\"files\"]:\n    #     history.append(((x,), None))\n    if message[\"text\"] is not None:\n        history.append((message[\"text\"], None))\n    return history, gr.MultimodalTextbox(value=None, interactive=False)\n\n\n# def multion_api_key_update(x):\n#     # global multion_api_key\n#     multion_api_key = x\n\n\n# def openai_api_key_update(x):\n#     # global openai_api_key\n#     openai_api_key = x\n\n\n# def replit_email_update(x):\n#     # global replit_email\n#     replit_email = x\n\n\n# def replit_password_update(x):\n#     # global replit_password\n#     replit_password = x\n\n\ndef bot(\n    history,\n    multion_api_key_in,\n    openai_api_key_in,\n    replit_email_in,\n    replit_password_in,\n    local,\n):\n    if len(multion_api_key_in) == 0:\n        raise gr.Error(\"MultiOn API Key is Required.\")\n    if len(openai_api_key_in) == 0:\n        raise gr.Error(\"OpenAI API Key is Required.\")\n    start_time = time.time()\n    devon = DevOn(\n        editor_image=image_temp,\n        browser_image=image_temp,\n        scratchpad_image=image_temp,\n        multion_api_key=multion_api_key_in,\n        openai_api_key=openai_api_key_in,\n        replit_email=replit_email_in,\n        replit_password=replit_password_in,\n        local=local,\n    )\n\n    for r in devon.run(history[-1][0]):\n        curr_time = time.time()\n        print(curr_time - start_time)\n        # if curr_time - start_time >= 300:\n        #     break\n        text, editor_image, browser_image, scratchpad_image = r\n        if type(text) == str:\n            history.append((None, text))\n        if editor_image is None:\n            editor_image = devon.editor_image\n            browser_image = devon.browser_image\n            scratchpad_image = devon.scratchpad_image\n        yield history, editor_image, browser_image, scratchpad_image\n\n\nwith gr.Blocks(css=\"footer {visibility: hidden}\") as demo:\n    md = gr.Markdown(\n        \"\"\"Notes:\n                     - Use \"Execute Locally\" for better results.\n                     - For local execution, you need to download the [MultiOn Browser Extension](https://chromewebstore.google.com/detail/multion/ddmjhdbknfidiopmbaceghhhbgbpenmm) and have \"API Enabled\" in the settings.\n                     - The Huggingface Spaces demo will timeout after 5 minutes by default. To test with longer tasks, [clone the repo](https://github.com/lordspline/DevOn) and run DevOn locally.\"\"\"\n    )\n    with gr.Row():\n        with gr.Column():\n            multion_api_key_in = gr.Textbox(label=\"MultiOn API Key\")\n            openai_api_key_in = gr.Textbox(label=\"OpenAI API Key\")\n        with gr.Column():\n            replit_email_in = gr.Textbox(label=\"Replit Email\")\n            replit_password_in = gr.Textbox(label=\"Replit Password\")\n    with gr.Row():\n        with gr.Column():\n            chatbot = gr.Chatbot(\n                [], elem_id=\"chatbot\", bubble_full_width=False, height=300\n            )\n\n            chat_input = gr.MultimodalTextbox(\n                value={\n                    \"text\": \"benchmark the perplexity api's resposne time with the api key abcdef\"\n                },\n                interactive=True,\n                file_types=[\"text\"],\n                placeholder=\"Enter message or upload file...\",\n                show_label=False,\n            )\n\n            with gr.Row():\n                local = gr.Checkbox(True, label=\"Execute Locally\")\n                terminate = gr.Button(\"Terminate\")\n        with gr.Column():\n            if devon:\n                editor_view = gr.Image(\n                    devon.editor_image,\n                    label=\"Editor\",\n                )\n            else:\n                editor_view = gr.Image()\n    with gr.Row():\n        with gr.Column():\n            if devon:\n                browser_view = gr.Image(\n                    devon.browser_image,\n                    label=\"Browser\",\n                )\n            else:\n                browser_view = gr.Image()\n        with gr.Column():\n            if devon:\n                scratchpad_view = gr.Image(\n                    devon.scratchpad_image,\n                    label=\"Scratchpad\",\n                )\n            else:\n                scratchpad_view = gr.Image()\n\n    chat_msg = chat_input.submit(\n        add_message, [chatbot, chat_input], [chatbot, chat_input]\n    )\n    bot_msg = chat_msg.then(\n        bot,\n        [\n            chatbot,\n            multion_api_key_in,\n            openai_api_key_in,\n            replit_email_in,\n            replit_password_in,\n            local,\n        ],\n        [chatbot, editor_view, browser_view, scratchpad_view],\n        api_name=\"bot_response\",\n    )\n    bot_msg.then(lambda: gr.MultimodalTextbox(interactive=True), None, [chat_input])\n\n    # multion_api_key_in.change(multion_api_key_update, multion_api_key_in)\n    # openai_api_key_in.change(openai_api_key_update, openai_api_key_in)\n    # replit_email_in.change(replit_email_update, replit_email_in)\n    # replit_password_in.change(replit_password_update, replit_password_in)\n\n    terminate.click(fn=None, inputs=None, outputs=None, cancels=[bot_msg])\n\n    # chatbot.like(print_like_dislike, None, None)\n\nif __name__ == \"__main__\":\n    demo.queue()\n    demo.launch(debug=True)\n"}
{"type": "source_file", "path": "prompts/programmer.py", "content": "# programmer_notes = \"\"\"Important Notes:\n# Do not refresh the page ever to check for anything. Only wait. Do not refresh.\n# You are working in a terminal environment.\n# You will do everything using the terminal and only the terminal.\n# If you need to create a new file, do so using the touch command on the terminal.\n# If you need to see files in the current directory, do so using ls.\n# If you need to view a files content, do so using the cat command on the terminal.\n# To enter code into a file, use a single printf command. After the printf command has been completely typed, press enter. Typing the command and pressing enter must be 2 separate steps.\n# Do not open a text editor like vim or nano.\n# If you need to install a new package, use pip install on the terminal.\n# Do not use the same command repeatedly.\n# When you write code into a file, write it once, cat it once, then stop. Do no attempt to write again unless it is wrong.\n# Remember that you need to press Enter after typing a command into the terminal. Only press enter after the command has been completely typed. Typing the command pressing enter must be 2 separate steps.\"\"\"\n\nprogrammer_notes = \"\"\"Important Notes:\nYou are a Programmer who works in a Replit Environment exclusively. If you need to install a package, use the Shell and not the Console.\nDo not refresh the page ever to check for anything. Only wait. Do not refresh. Do not create new files. Write your code in currently open editor window itself. Do not type double quotation marks. If you are asked to type code containing them, use single quotes instead.\"\"\"\n"}
{"type": "source_file", "path": "prompts/__init__.py", "content": ""}
